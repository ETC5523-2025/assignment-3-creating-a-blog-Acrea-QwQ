---
title: "Listening to Rivers Through Data"
author: "Xingyu Wang"
date: "2025-10-10"
categories: [blog]
---

```{r}
#| include: false
library(knitr)
library(here)
```

Exploring how a handful of variables can tell the story of a riverâ€™s changing chemistry.

![Source: Julie rubacha/Shutterstock.com](/photo/river.jpg){fig-align="center"}

# When Rivers Tell Stories: What Controls Nitrate Levels? {#sec-ProblemDescription}

If youâ€™ve ever stood by a river and wondered how clean that water really is â€” youâ€™re not alone. Nitrate, a common compound found in fertilizers, quietly flows through rivers around the world. When its levels get too high, ecosystems suffer and water treatment costs soar.

Traditionally, tracking nitrate means sending people out to collect water samples, shipping them to labs, and waiting for results. Itâ€™s slow, costly, and often misses the real-time ups and downs that matter most.

But what if we could understand how nitrate changes just by watching a few key signals â€” like temperature or water clarity â€” from sensors already sitting in the river?

Thatâ€™s exactly what a recent study explored: whether smart modelling and a few well-chosen measurements could explain nitrate dynamics almost perfectly â€” and do it affordably.

# Seeing Patterns Beneath the Surface {#Analysis}
This blog builds on the study @paper, which provides the foundation for the discussion here. The analysis draws on data from @neondata, collected between 2018 and 2019 at three NEON river sites in Colorado, Alaska, and Virginia.

## Understanding how the model works

To understand the studyâ€™s key insight, we first need to look at how its model works. When studying nitrate changes in rivers, weâ€™re dealing with data that are both nonlinear and temporal â€” relationships that bend and fluctuate over time. A simple linear regression canâ€™t capture both at once. To bridge that gap, the researchers built a two-step framework using GAM and GAMM, which together reveal smooth environmental patterns while accounting for time dependence.

The first layer, a GAM (Generalized Additive Model), replaces straight-line predictors with flexible smooth functions.

$$
\text{Nitrate}_t = \beta_0 + s_1(\text{Temp}_t) + s_2(\text{Cond}_t) + s_3(\text{DO}_t)
+ s_4(\text{Turb}_t) + s_5(\text{Elev}_t) + \varepsilon_t
$$

To capture short-term memory in the data, the second layer adds a time-series component â€” the GAMM (Generalized Additive Mixed Model):

$$
\text{Nitrate}_t = \beta_0 + \sum_i s_i(X_{i,t}) + \phi\,\text{Nitrate}_{t-1} + \varepsilon_t
$$

This autoregressive term Ï• corrects for temporal autocorrelation, ensuring that the model respects how todayâ€™s water chemistry depends on yesterdayâ€™s. Together, these two parts make the framework both flexible and robust.

Together, these two components form the core logic of the framework â€” but the modelâ€™s strength also comes from how carefully it was designed and validated across sites.

## Key Technical Details

Three design choices make this modelling framework both reliable and transferable.
First, the authors validated their models across sites â€” training on one river and testing on the others. This cross-site validation confirmed that the modelâ€™s predictive accuracy holds under different climatic and land-use conditions.

Second, they filtered variables for collinearity, excluding measures such as pH, fDOM, and discharge to avoid redundancy. This ensured that each remaining variable captured distinct physical or chemical information rather than overlapping effects.

Finally, the model accounted for temporal autocorrelation using an AR(1) structure, where each 15-minute observation was partly informed by the previous one. This step allowed the model to reflect short-term persistence in water chemistry and helped raise its explanatory power to 99%.

## What the model reveals

Using this combined GAMâ€“GAMM approach, the researchers explained nearly 99% of the variation in nitrate concentration. The result is methodologically elegant yet practically efficient â€” showing that relatively simple models, when properly structured, can capture complex biogeochemical dynamics with impressive precision.

Across all sites, five water-quality variables consistently told the story, as shown in the following @tbl-water-variables which presents their specific meanings.

<div style="text-align: center;">
<div style="display: inline-block; text-align: left;">

**ðŸŒ¡ Temperature**  
**ðŸŒ« Turbidity**  
**âš¡ Conductivity**  
**ðŸ’¨ Dissolved oxygen**  
**ðŸŒŠ Surface water elevation**

</div>
</div>

```{r}
#| echo: false
#| tbl-cap: "Key water-quality variables and why they matter for nitrate analysis"
#| label: tbl-water-variables

knitr::kable(
  data.frame(
    Variable = c("Temperature","Turbidity","Conductivity","Dissolved Oxygen","Surface Water Elevation"),
    Meaning = c(
      "Water warmth",
      "Water cloudiness",
      "Ability to conduct electricity",
      "Oxygen level in water",
      "River height"
    ),
    WhyItMatters = c(
      "Affects biological activity and nitrate conversion rates.",
      "Indicates sediment and nutrient presence; higher turbidity often means more suspended particles that carry nitrate.",
      "Reflects dissolved ions and materials in water, which often correlate with nutrient loads.",
      "Related to microbial processes that consume or transform nitrate.",
      "Influences flow, dilution, and mixing, which affect nitrate concentration."
    )
  ))

```


Even though these five factors mattered everywhere, their influence varied from site to site. For instance, in one river, short-term memory â€” the riverâ€™s own recent history â€” played a big role; in another, the physical conditions dominated.

In other words, rivers share some â€œuniversal rules,â€ but each has its own accent. @fig-Variable_importance shows how each variable contributes differently across the three sites. At Arikaree, for instance, the autoregressive term accounts for roughly 25% of the variation in nitrate, whereas at Lewis Run, all five variables play a substantial role.
This contrast highlights that reliable monitoring depends not only on the common drivers shared across rivers, but also on local conditions that shape how each variable matters.
Overall, these results illustrate that while some patterns are universal, local context can strongly influence the relative importance of each factor.

```{r}
#| echo: false
#| label: fig-Variable_importance
#| fig-cap: "Five water-quality variables explain nitrate variation at three NEON river sites (2018â€“2019). At Lewis Run, all exceed 10%, conductivity >15%. Each GAMM explains about 99% of total deviance across sites (Reproduced from @paper)."
knitr::include_graphics(here::here("photo/fig1.jpg"))
```

# Smarter Monitoring, Better Decisions {#Conclusion}

The main takeaway is clear: it is not necessary to measure every variable at every site at all times.

By concentrating monitoring efforts on a small set of key indicators â€” specifically temperature, turbidity, conductivity, dissolved oxygen, and water level â€” environmental agencies can develop monitoring programs that are both cost-effective and high-frequency. Such programs are capable of capturing the dynamic behavior of rivers with sufficient accuracy, without expending resources on less informative measurements.

Now, we can finally return to the question in @sec-ProblemDescription â€” and see that a relatively small set of well-chosen measurements is indeed enough to reveal the patterns that govern nitrate dynamics.

In a context of limited budgets and increasing environmental pressures, this approach represents an efficient balance between scientific rigor and practical feasibility. It allows agencies to maintain reliable oversight of water quality while directing resources where they have the greatest impact, contributing both to sustainable management and to informed, data-driven decision-making.
